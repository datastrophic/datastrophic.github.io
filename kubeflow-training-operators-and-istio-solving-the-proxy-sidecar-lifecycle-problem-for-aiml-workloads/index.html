<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#FFFFFF"><title>Kubeflow Training Operators and Istio: solving the proxy sidecar lifecycle problem for AI/ML workloads &#183; datastrophic</title><meta name=title content="Kubeflow Training Operators and Istio: solving the proxy sidecar lifecycle problem for AI/ML workloads &#183; datastrophic"><script type=text/javascript src=https://datastrophic.io/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=https://datastrophic.io/css/main.bundle.min.a69666ab095effe32fc9dca4e8a9857d8bc1b9e9efcc29ff41379d3765f0262b.css integrity="sha256-ppZmqwle/+Mvydyk6KmFfYvBuenvzCn/QTedN2XwJis="><script defer type=text/javascript id=script-bundle src=https://datastrophic.io/js/main.bundle.min.d4b727caf411cb5c3b421d0d427ed1e3daeafe0d04840327efad4978430edb8c.js integrity="sha256-1LcnyvQRy1w7Qh0NQn7R49rq/g0EhAMn761JeEMO24w=" data-copy=Copy data-copied=Copied></script><meta name=description content="
      
        With Kubeflow gaining traction in the community and its early adoption in enterprises, security and observability concerns become more and more important. Many organizations that are running AI/ML workloads, operate with sensitive personal or financial data and have stricter requirements for data encryption, traceability, and access control. Quite often, we can see the use of the Istio service mesh for solving these problems and gaining other benefits of the rich functionality it provides.
      
    "><link rel=canonical href=https://datastrophic.io/kubeflow-training-operators-and-istio-solving-the-proxy-sidecar-lifecycle-problem-for-aiml-workloads/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://datastrophic.io/kubeflow-training-operators-and-istio-solving-the-proxy-sidecar-lifecycle-problem-for-aiml-workloads/"><meta property="og:site_name" content="datastrophic"><meta property="og:title" content="Kubeflow Training Operators and Istio: solving the proxy sidecar lifecycle problem for AI/ML workloads"><meta property="og:description" content="With Kubeflow gaining traction in the community and its early adoption in enterprises, security and observability concerns become more and more important. Many organizations that are running AI/ML workloads, operate with sensitive personal or financial data and have stricter requirements for data encryption, traceability, and access control. Quite often, we can see the use of the Istio service mesh for solving these problems and gaining other benefits of the rich functionality it provides."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-04T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-04T00:00:00+00:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Kubeflow"><meta property="article:tag" content="Istio"><meta property="article:tag" content="Operators"><meta property="article:tag" content="Mlops"><meta name=twitter:card content="summary"><meta name=twitter:title content="Kubeflow Training Operators and Istio: solving the proxy sidecar lifecycle problem for AI/ML workloads"><meta name=twitter:description content="With Kubeflow gaining traction in the community and its early adoption in enterprises, security and observability concerns become more and more important. Many organizations that are running AI/ML workloads, operate with sensitive personal or financial data and have stricter requirements for data encryption, traceability, and access control. Quite often, we can see the use of the Istio service mesh for solving these problems and gaining other benefits of the rich functionality it provides."><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"","name":"Kubeflow Training Operators and Istio: solving the proxy sidecar lifecycle problem for AI\/ML workloads","headline":"Kubeflow Training Operators and Istio: solving the proxy sidecar lifecycle problem for AI\/ML workloads","abstract":"With Kubeflow gaining traction in the community and its early adoption in enterprises, security and observability concerns become more and more important. Many organizations that are running AI\/ML workloads, operate with sensitive personal or financial data and have stricter requirements for data encryption, traceability, and access control. Quite often, we can see the use of the Istio service mesh for solving these problems and gaining other benefits of the rich functionality it provides.","inLanguage":"en","url":"https:\/\/datastrophic.io\/kubeflow-training-operators-and-istio-solving-the-proxy-sidecar-lifecycle-problem-for-aiml-workloads\/","author":{"@type":"Person","name":"Anton Kirillov"},"copyrightYear":"2021","dateCreated":"2021-10-04T00:00:00\u002b00:00","datePublished":"2021-10-04T00:00:00\u002b00:00","dateModified":"2021-10-04T00:00:00\u002b00:00","keywords":["kubernetes","kubeflow","istio","operators","mlops"],"mainEntityOfPage":"true","wordCount":"2553"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://datastrophic.io/","name":"","position":1},{"@type":"ListItem","item":"https://datastrophic.io/posts/","name":"","position":2},{"@type":"ListItem","item":"https://datastrophic.io/categories/kubeflow/","name":"Kubeflow","position":3},{"@type":"ListItem","name":"Kubeflow Training Operators and Istio Solving the Proxy Sidecar Lifecycle Problem for Ai Ml Workloads","position":4}]}</script><meta name=author content="Anton Kirillov"><link href=https://www.linkedin.com/in/datastrophic/ rel=me><link href=https://github.com/datastrophic rel=me><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z9WG27GT0G"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z9WG27GT0G")}</script></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden"><nav class="flex items-start justify-between sm:items-center"><div class="z-40 flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>datastrophic</a></div><label id=menu-button for=menu-controller class="block sm:hidden"><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"><ul class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 text-end sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class="group mb-1"><a href=/posts/ title onclick=close_menu()><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">archive</span></a></li><li class="group mb-1"><a href=/about/ title onclick=close_menu()><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">about</span></a></li></ul></div></label><ul class="hidden list-none flex-row text-end sm:flex"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">archive</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/about/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">about</span></a></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Kubeflow Training Operators and Istio: solving the proxy sidecar lifecycle problem for AI/ML workloads</h1><div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2021-10-04 00:00:00 +0000 UTC">4 October 2021</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">12 mins</span></div></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="min-h-0 min-w-0 max-w-prose grow"><p>With Kubeflow gaining traction in the community and its early adoption in enterprises, security and observability concerns become more and more important. Many organizations that are running AI/ML workloads, operate with sensitive personal or financial data and have stricter requirements for data encryption, traceability, and access control. Quite often, we can see the use of the Istio service mesh for solving these problems and gaining other benefits of the rich functionality it provides.</p><p>Kubeflow relies on Istio for traffic routing, authorization policies, and user access control. However, at the moment of writing, it did not fully support Istio for the workloads running on top of it. This post covers architectural and design issues specific to running Kubeflow workloads on Istio and focuses on specific problems of the AI/ML training jobs: <code>TFJob</code>, <code>PyTorchJob</code>, and alike. In the end, the post presents a reference implementation of the Istio Aux Controller - an auxiliary Kubernetes Operator that helps to solve these problems in a fully automated manner.</p><h2 id=istio class="relative group">Istio <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#istio aria-label=Anchor>#</a></span></h2><h3 id=high-level-architecture class="relative group">High-level architecture <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#high-level-architecture aria-label=Anchor>#</a></span></h3><p>It is important to have a basic understanding of how Istio is designed at a high level.</p><p><a href=https://istio.io/latest/docs/ops/deployment/architecture/ target=_blank rel=noreferrer>Official documentation</a> provides an in-depth overview
of all components but for the purpose of this post, we will be focusing mostly on the data plane.</p><p><figure><img src=./istio-architecture.svg alt="Istio Architecture" class="mx-auto my-0 rounded-md"></figure></p><p>Image source: <a href=https://istio.io/latest/docs/ops/deployment/architecture/ target=_blank rel=noreferrer>Istio architectrue documentation</a></p><p>Istio Control Plane injects Envoy proxies as sidecar containers running alongside the payload containers in the same pod. Once the proxy is up and running, it starts managing all network communication between pods in the mesh and also receiving configuration updates from the Control Plane. All the access policies and traffic routes are configured via Control Plane and then enforced by proxies.</p><blockquote><p>To enable sidecar injection at the namespace level, the namespace should have <code>istio-injection: enabled</code> label</p></blockquote><h3 id=sidecar-injection class="relative group">Sidecar injection <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#sidecar-injection aria-label=Anchor>#</a></span></h3><p>Let&rsquo;s take a deeper look into the timeline of the events when Istio injection is enabled and a new <code>Pod</code>
is being created:</p><ol><li>The Istio CNI plugin configures Pod&rsquo;s <code>iptables</code> to route all traffic to the Proxy.</li><li>If there are any <code>initContainers</code> specified, they start and must complete prior to starting the payload and sidecar containers.</li><li>Payload and sidecar containers start.</li></ol><h3 id=the-network-availability-issue class="relative group">The network availability issue <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#the-network-availability-issue aria-label=Anchor>#</a></span></h3><p>While the injection model looks straightforward, there&rsquo;s one major design flaw here - the <code>Pod</code> network is unreachable until the proxy sidecar starts. Let&rsquo;s revisit the timeline from this perspective:</p><ol><li>Istio CNI plugin configures routing of all traffic to a non-existent proxy (<strong>network becomes unavailable</strong>)</li><li><code>initContainers</code> run</li><li>Payload and sidecar containers start</li><li>Proxy starts (<strong>network is available again</strong>)</li></ol><p>This means that if any of the payload containers or <code>initContainers</code> requires network access - it is sensitive to this issue:</p><ul><li>when a payload container requires network connectivity on start - it will crashloop until the sidecar proxy is started</li><li>a situation when any of the <code>initContainers</code> depends on fetching the data over the network (and fails otherwise) introduces a deadlock because none of the payload or sidecar containers can start until all the <code>initContainers</code> complete.</li></ul><blockquote><p>The <code>initContainers</code> deadlock issue is beyond the scope of this post as it doesn&rsquo;t affect the Kubeflow training jobs.</p></blockquote><h3 id=the-job-completion-issue class="relative group">The Job completion issue <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#the-job-completion-issue aria-label=Anchor>#</a></span></h3><p>Apart from the racy network availability during the <code>Pod</code> startup, there&rsquo;s another issue with the Kubernetes Job-like resources and their handling of the sidecar. Depending on the type of a Kubernetes Controller or an Operator managing the created resource, the problem is that the Istio Proxy keeps running after the payload container is completed and prevents the <code>Job</code> (and Job-like) resources from completion.</p><h2 id=training-operators-on-istio class="relative group">Training Operators on Istio <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#training-operators-on-istio aria-label=Anchor>#</a></span></h2><p>When running distributed training jobs using Tensorflow, PyTorch, or MXNet Operators, it is pretty standard for the training code to access the dataset at a remote location over the network (e.g. from cloud storage). This makes it sensitive to the network availability issue and can lead to sporadic failures when running on Istio. Tensorflow will be used for illustration purposes here, however, the problem surface and approaches to solving it are equally applicable to the PyTorch, MXNet, and other Training Operators.</p><p>Let&rsquo;s consider this naive MNIST classification code as an example workload. Note, the <code>mnist.load_data()</code> call downloads the sample dataset from a remote location and requires the network to be available.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>tensorflow</span> <span class=k>as</span> <span class=nn>tf</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># import MNIST dataset</span>
</span></span><span class=line><span class=cl><span class=n>mnist</span> <span class=o>=</span> <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>datasets</span><span class=o>.</span><span class=n>mnist</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>x_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>),</span> <span class=p>(</span><span class=n>x_test</span><span class=p>,</span> <span class=n>y_test</span><span class=p>)</span> <span class=o>=</span> <span class=n>mnist</span><span class=o>.</span><span class=n>load_data</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>x_train</span><span class=p>,</span> <span class=n>x_test</span> <span class=o>=</span> <span class=n>x_train</span> <span class=o>/</span> <span class=mf>255.0</span><span class=p>,</span> <span class=n>x_test</span> <span class=o>/</span> <span class=mf>255.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># define and compile the model</span>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>models</span><span class=o>.</span><span class=n>Sequential</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>layers</span><span class=o>.</span><span class=n>Flatten</span><span class=p>(</span><span class=n>input_shape</span><span class=o>=</span><span class=p>(</span><span class=mi>28</span><span class=p>,</span> <span class=mi>28</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>layers</span><span class=o>.</span><span class=n>Dense</span><span class=p>(</span><span class=mi>128</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=s2>&#34;relu&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>layers</span><span class=o>.</span><span class=n>Dropout</span><span class=p>(</span><span class=mf>0.2</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>layers</span><span class=o>.</span><span class=n>Dense</span><span class=p>(</span><span class=mi>10</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>model</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=n>optimizer</span><span class=o>=</span><span class=s2>&#34;adam&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>loss</span><span class=o>=</span><span class=s2>&#34;sparse_categorical_crossentropy&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>metrics</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;accuracy&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># train the model</span>
</span></span><span class=line><span class=cl><span class=n>model</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>x_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> <span class=n>epochs</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span></code></pre></div><p>To run this code on a Kubernetes cluster, it needs to be saved into a file (for example, <code>mnist.py</code>) and packed into a Docker image so that it can be pulled and used on any of the cluster nodes by training operator workers. We will use a pre-built Docker image that already includes the code from the above snippet: <code>datastrophic/tensorflow:2.6.0-mnist</code>. Let&rsquo;s create the following <code>TFJob</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>kubeflow.org/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>TFJob</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mnist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tfReplicaSpecs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>Worker</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>OnFailure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>tensorflow</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>datastrophic/tensorflow:2.6.0-mnist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;python&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;-u&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;mnist.py&#39;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><p>It can take some time to pull the image but once it is pulled and launched we can check its logs to see it was unable to download the dataset. For that, let&rsquo;s look into one of the worker pods logs:</p><pre tabindex=0><code>$&gt; kubectl logs mnist-worker-0 -c tensorflow

Downloading data from https://storage.googleapis.com/tensorflow/tf-keras-datasets/mnist.npz
Traceback (most recent call last):

... &lt;part of the log omitted for better readability&gt;

Exception: URL fetch failure on https://storage.googleapis.com/tensorflow/tf-keras-datasets/mnist.npz: None -- [Errno 101] Network is unreachable
</code></pre><p>Although after a couple of attempts the <code>Job</code> will be able to start and pull the data - in a situation when Istio Proxy becomes ready before the payload container attempts to access the network - the <code>Job</code> won&rsquo;t be able to complete with a single container still running. And this single container is the Istio Proxy that is unaware of other sidecars. We can see the event timeline here:</p><pre tabindex=0><code>$&gt; kubectl get pod mnist-worker-0 -w
NAME             READY   STATUS            RESTARTS   AGE
mnist-worker-0   0/2     Init:0/1          0          1s
mnist-worker-0   0/2     PodInitializing   0          6s
mnist-worker-0   1/2     Running           0          9s
mnist-worker-0   2/2     Running           0          16s
mnist-worker-0   1/2     NotReady          0          2m21s
</code></pre><p>Let&rsquo;s now take a look into the prior art and the possible workarounds discussed in the community.</p><h2 id=prior-art class="relative group">Prior art <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#prior-art aria-label=Anchor>#</a></span></h2><p>There were quite a few discussions, threads, and blog posts about how these issues can be resolved or if there&rsquo;s any workaround for them. What follows is a quick overview of the most frequently mentioned approaches.</p><h3 id=the-networking-issue class="relative group">The networking issue <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#the-networking-issue aria-label=Anchor>#</a></span></h3><p>One of the most common solutions for this problem is to modify the container command and wait for the sidecar proxy to become available as for example recommended in <a href=https://github.com/istio/istio/issues/11130 target=_blank rel=noreferrer>istio/issues#11130</a>. The modified command for the <code>TFJob</code> can look as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;bash&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;-c&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>args</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;until curl --silent --head --fail localhost:15000 &gt; /dev/null; do sleep 1; done; python -u mnist.py&#39;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><p>The entrypoint probes Envoy proxy port <code>15000</code> until it becomes available and executes the training code only after that.</p><p>Yet another intuitive solution when the network access to the remote data is not stable is to introduce retries in the source code responsible for its retrieval. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@retry</span><span class=p>(</span><span class=n>wait_fixed</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_dataset</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>mnist</span> <span class=o>=</span> <span class=n>tf</span><span class=o>.</span><span class=n>keras</span><span class=o>.</span><span class=n>datasets</span><span class=o>.</span><span class=n>mnist</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>mnist</span><span class=o>.</span><span class=n>load_data</span><span class=p>()</span>
</span></span></code></pre></div><p>This looks more like a bandaid for the given example but, in general, retries can improve resilience and help to avoid transient failures in the presence of unreliable data sources.</p><h3 id=the-sidecar-termination-issue class="relative group">The sidecar termination issue <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#the-sidecar-termination-issue aria-label=Anchor>#</a></span></h3><p>One of the available approaches is similar to the Envoy probing and proposes to change the entrypoint and terminate the Istio Proxy either via <code>pkill</code> or by calling a dedicated endpoint <code>http://127.0.0.1:15020/quitquitquit</code>. Based on this <a href=https://github.com/istio/istio/issues/11659#issuecomment-479547294 target=_blank rel=noreferrer>GitHub comment</a>, the final entrypoint command for the example MNIST <code>TFJob</code> would look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/bash&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-c&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>args</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    trap &#34;curl --max-time 2 -s -f -XPOST http://127.0.0.1:15000/quitquitquit&#34; EXIT
</span></span></span><span class=line><span class=cl><span class=sd>    while ! curl -s -f http://127.0.0.1:15020/healthz/ready; do sleep 1; done
</span></span></span><span class=line><span class=cl><span class=sd>    python -u mnist.py</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>An important note on using <code>pkill</code> instead of <code>/quitquitquit</code> is that <code>pkill</code> would require a <a href=https://kubernetes.io/docs/tasks/configure-pod-container/share-process-namespace/ target=_blank rel=noreferrer>shared process namespace between containers in the pod</a> which has its own security implications.</p></blockquote><p>Another approach described in <a href=https://medium.com/redbox-techblog/handling-istio-sidecars-in-kubernetes-jobs-c392661c4af7 target=_blank rel=noreferrer>Handling Istio Sidecars in Kubernetes Jobs</a> proposes a helper process to wrap the entrypoint and communicate with Envoy waiting for it to start and terminating it after the wrapped application stops.</p><p><a href=https://charlesxu.io/istio-short/ target=_blank rel=noreferrer>The Good, Bad, and Ugly: Istio for Short-lived Pods</a> proposes to inject a wrapper binary, and overwrite the entrypoint command via a webhook, and then trigger the binary subcommand from an accompanying controller to terminate the proxy (similar to <code>kubectl exec</code>).</p><h3 id=conclusion class="relative group">Conclusion <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#conclusion aria-label=Anchor>#</a></span></h3><p>All the approaches described above have pros and cons but the main drawback is that the initial workloads can not be moved to Istio without modifying either the manifests, entrypoints, or the source code (in case of retries). At any reasonable scale, the number of changes would be significant enough to abandon an initiative like this one. The automated mutation of the entrypoint looks the closest to a proper solution, however, proposes to inject an init container with a wrapper binary and mutate the entrypoint which is not always feasible as there could be issues related to container ordering and multi-container pods.</p><h2 id=meet-istio-aux-controller class="relative group">Meet Istio AUX Controller <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#meet-istio-aux-controller aria-label=Anchor>#</a></span></h2><h3 id=overview class="relative group">Overview <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#overview aria-label=Anchor>#</a></span></h3><p>All the workarounds and the lack of an out-of-the-box solution lead me to prototyping a simple <code>MutatingAdmissionWebhook</code> and a <code>Pod</code> Controller that aimed at solving the above issues with the following principles in mind:</p><ul><li>The existing user code including Kubernetes manifests should not change to work on Istio.</li><li>Full automation. Once the solution is in place - it can be enabled or disabled per namespace by a user.</li><li>Narrow scope and the low impact that doesn&rsquo;t require changing of the global settings.</li><li>Container entrypoint must not be mutated. The majority of the workarounds deal with single-container <code>Pods</code> in <code>Jobs</code>. There might be other containers dependent on the network.</li></ul><p>The good news is that in version 1.7, <a href=https://istio.io/latest/news/releases/1.7.x/announcing-1.7/change-notes/ target=_blank rel=noreferrer>Istio introduced</a> a global configuration property <code>values.global.proxy.holdApplicationUntilProxyStarts</code> that injects the sidecar container at the beginning of the container list of a <code>Pod</code> and causes other containers to wait until it starts. This is described in great details in a blog post by <a href=https://medium.com/@marko.luksa/delaying-application-start-until-sidecar-is-ready-2ec2d21a7b74 target=_blank rel=noreferrer>Marko Luk≈°a: Delaying application start until sidecar is ready</a>.</p><p>Istio AUX contains a <code>MutatingAdmissionWebhook</code> that mutates the pods submitted to namespaces with specific labels and adds an Istio-specific annotation to Pods:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>proxy.istio.io/config</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;holdApplicationUntilProxyStarts: true&#34;</span><span class=w>
</span></span></span></code></pre></div><p>That way, Istio Operator will take care of the rearranging of the sidecars and delaying the first non-Istio container start until the proxy is ready. This can also be solved, by setting the same Istio Proxy property globally, however, it is <code>false</code> by default and it&rsquo;s not clear whether this setting can impact other existing deployments outside Kubeflow.</p><p>Another part of the Istio AUX Controller is the Controller itself that is also scoped to namespaces with specific labels and subscribed to <code>Pod</code> Update events. All the container status changes trigger the reconciliation, and the controller keeps checking what containers are still running in the <code>Pod</code>. Once there&rsquo;s only one left and it is Istio Proxy, the Controller execs into a pod and runs <code>curl -sf -XPOST http://127.0.0.1:15020/quitquitquit</code> inside it. Istio Proxy container image has <code>curl</code> pre-installed so there&rsquo;s no need for an additional binary or a sidecar to terminate the proxy.</p><p>The termination heuristic is pretty naive but it is easy to extend it to a more sophisticated version e.g. checking against a list of container names that have to exit prior to terminating the Proxy.</p><p><strong>Istio AUX Controller</strong> is a reference implementation for the above approach and is available on GitHub at <a href=https://github.com/datastrophic/istio-aux target=_blank rel=noreferrer>datastrophic/istio-aux</a>.</p><h3 id=demo class="relative group">Demo <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#demo aria-label=Anchor>#</a></span></h3><h4 id=prerequisites class="relative group">Prerequisites <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#prerequisites aria-label=Anchor>#</a></span></h4><p>You should have a Kubernetes cluster available, <a href=https://kind.sigs.k8s.io/ target=_blank rel=noreferrer>kind</a> will suffice but ensure the Docker daemon has sufficient resources to accommodate for cert-manager, Istio, Kubeflow Training Operator, and run a two-pod <code>TFJob</code> (8CPU, 8GB RAM should be sufficient). The following software is required:</p><ul><li><a href=https://kind.sigs.k8s.io/ target=_blank rel=noreferrer>kind</a></li><li><a href=https://kubernetes.io/docs/tasks/tools/#kubectl target=_blank rel=noreferrer>kubectl</a></li><li><a href=https://istio.io/latest/docs/setup/getting-started/#download target=_blank rel=noreferrer>istioctl</a></li></ul><h4 id=cluster-setup class="relative group">Cluster setup <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#cluster-setup aria-label=Anchor>#</a></span></h4><p>The cluster setup is pretty straightforward. The only highlight here is that we will use the Composite Operator that supports all types of training jobs (former TF Operator).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kind create cluster
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># wait for node(s) to become ready</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>wait</span> --for <span class=nv>condition</span><span class=o>=</span>Ready node --all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># install cert-manager</span>
</span></span><span class=line><span class=cl>kubectl create -f https://github.com/jetstack/cert-manager/releases/download/v1.5.3/cert-manager.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># wait for pods to become ready</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>wait</span> --for<span class=o>=</span><span class=nv>condition</span><span class=o>=</span>Ready pods --all --namespace cert-manager
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># install istio</span>
</span></span><span class=line><span class=cl>istioctl install --set <span class=nv>profile</span><span class=o>=</span>demo -y
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># install the training operator</span>
</span></span><span class=line><span class=cl>kubectl apply -k <span class=s2>&#34;github.com/kubeflow/tf-operator.git/manifests/overlays/standalone?ref=master&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># wait for pods to become ready</span>
</span></span><span class=line><span class=cl>kubectl <span class=nb>wait</span> --for<span class=o>=</span><span class=nv>condition</span><span class=o>=</span>Ready pods --all --namespace kubeflow
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># install the Istio AUX controller</span>
</span></span><span class=line><span class=cl>kubectl apply -k <span class=s2>&#34;github.com/datastrophic/istio-aux.git/config/default?ref=master&#34;</span>
</span></span></code></pre></div><h4 id=deploying-the-workloads class="relative group">Deploying the workloads <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#deploying-the-workloads aria-label=Anchor>#</a></span></h4><p>Let&rsquo;s create a <code>TFJob</code> that will be used for testing, enable Istio injection for the default namespace, and submit the job:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl label namespace default istio-injection<span class=o>=</span>enabled
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./tfjob.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: kubeflow.org/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: TFJob
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: mnist
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  tfReplicaSpecs:
</span></span></span><span class=line><span class=cl><span class=s>    Worker:
</span></span></span><span class=line><span class=cl><span class=s>      replicas: 2
</span></span></span><span class=line><span class=cl><span class=s>      restartPolicy: OnFailure
</span></span></span><span class=line><span class=cl><span class=s>      template:
</span></span></span><span class=line><span class=cl><span class=s>        spec:
</span></span></span><span class=line><span class=cl><span class=s>          containers:
</span></span></span><span class=line><span class=cl><span class=s>          - name: tensorflow
</span></span></span><span class=line><span class=cl><span class=s>            image: datastrophic/tensorflow:2.6.0-mnist
</span></span></span><span class=line><span class=cl><span class=s>            command: [&#39;python&#39;, &#39;-u&#39;, &#39;mnist.py&#39;]
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl create -f tfjob.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get pods -w
</span></span></code></pre></div><p>We&rsquo;ll see that the <code>Pods</code> will eventually get stuck in the <code>NotReady</code> state with one container still running.</p><p>Now let&rsquo;s enable the Istio AUX Controller for the default namespace and redeploy the <code>TFJob</code> one more time.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl delete -f tfjob.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl label namespace default io.datastrophic/istio-aux<span class=o>=</span>enabled
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl create -f tfjob.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get pods -w
</span></span></code></pre></div><p>This time, all the pods reached the <code>Completed</code> state.</p><p>In the meantime, the Istio AUX Controller logs contain an output like this:</p><pre tabindex=0><code>...
INFO	webhook.webhook	processing pod mnist-worker-0
INFO	webhook.webhook	pod mnist-worker-0 processed
...
INFO	webhook.webhook	processing pod mnist-worker-1
INFO	webhook.webhook	pod mnist-worker-1 processed
...
INFO	istio-aux	found a pod with istio proxy, checking container statuses	{&#34;pod&#34;: &#34;mnist-worker-0&#34;}
INFO	istio-aux	some containers are still running, skipping istio proxy shutdown	{&#34;pod&#34;: &#34;mnist-worker-0&#34;, &#34;containers&#34;: [&#34;tensorflow&#34;]}
...
INFO	istio-aux	found a pod with istio proxy, checking container statuses	{&#34;pod&#34;: &#34;mnist-worker-1&#34;}
INFO	istio-aux	some containers are still running, skipping istio proxy shutdown	{&#34;pod&#34;: &#34;mnist-worker-1&#34;, &#34;containers&#34;: [&#34;tensorflow&#34;]}
...
INFO	istio-aux	found a pod with istio proxy, checking container statuses	{&#34;pod&#34;: &#34;mnist-worker-0&#34;}
INFO	istio-aux	the payload containers are terminated, proceeding with the proxy shutdown	{&#34;pod&#34;: &#34;mnist-worker-0&#34;}
...
INFO	istio-aux	found a pod with istio proxy, checking container statuses	{&#34;pod&#34;: &#34;mnist-worker-1&#34;}
INFO	istio-aux	the payload containers are terminated, proceeding with the proxy shutdown	{&#34;pod&#34;: &#34;mnist-worker-1&#34;}
...
INFO	istio-aux	found a pod with istio proxy, checking container statuses	{&#34;pod&#34;: &#34;mnist-worker-0&#34;}
INFO	istio-aux	istio-proxy is already in a terminated state	{&#34;pod&#34;: &#34;mnist-worker-0&#34;}
...
INFO	istio-aux	found a pod with istio proxy, checking container statuses	{&#34;pod&#34;: &#34;mnist-worker-1&#34;}
INFO	istio-aux	istio-proxy is already in a terminated state	{&#34;pod&#34;: &#34;mnist-worker-1&#34;}
...
</code></pre><h2 id=final-thoughts class="relative group">Final thoughts <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line:none !important" href=#final-thoughts aria-label=Anchor>#</a></span></h2><p>The proposed solution works for existing versions of Kubernetes and Istio but given the fast pace of their evolution might become outdated relatively quickly. It would be nice to have similar functionality in either but it is understandable that container interdependencies in <code>Pods</code> do not generalize well for a universal generic solution.</p><p>Ideally, it would be great to have this problem solved by Kubernetes itself. As described in <a href=https://banzaicloud.com/blog/k8s-sidecars/ target=_blank rel=noreferrer>Sidecar container lifecycle changes in Kubernetes 1.18</a>, it was proposed to assign containers with a <code>lyfecycle</code> type so that the sidecars would be terminated by the Kubelet once the payload containers complete.</p><p>Although the reference implementation addresses a specific case and a subset of Kubeflow Operators it provides a relatively generic solution to a problem but of course, requires additional work to productionize it.</p><p>Please don&rsquo;t hesitate to reach out to me with feedback and/or if you are interested in collaboration.</p></div></section><footer class="max-w-prose pt-8 print:hidden"><div class=flex><picture class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"><img width=400 height=400 class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full" alt="Anton Kirillov" loading=lazy decoding=async src=https://datastrophic.io/img/author.jpg></picture><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Anton Kirillov</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Technical Leader. Compute and AI Infrastructure</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://www.linkedin.com/in/datastrophic/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/datastrophic target=_blank aria-label=Github rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=https://datastrophic.io/spark-jobserver-from-spark-standalone-to-mesos-marathon-and-docker-part-i/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Spark JobServer: from Spark Standalone to Mesos, Marathon and Docker</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2017-10-12 00:00:00 +0000 UTC">12 October 2017</time>
</span></span></a></span><span><a class="group flex text-right" href=https://datastrophic.io/kubernetes-homelab-with-proxmox-kubeadm-calico-openebs-and-metallb/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">The Ultimate Kubernetes Homelab Guide: From Zero to Production Cluster On-Premises</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2021-12-01 00:00:00 +0000 UTC">1 December 2021</time>
</span></span><span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div></footer></article></main><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12" id=to-top hidden=true><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">¬© 2025 datastrophic</p></div><div class="flex flex-row items-center"><div class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher-0 type=button aria-label="appearance switcher"><div class="flex h-12 w-12 items-center justify-center dark:hidden" title="Switch to dark appearance"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden h-12 w-12 items-center justify-center dark:flex" title="Switch to light appearance"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div></div></footer></div></body></html>